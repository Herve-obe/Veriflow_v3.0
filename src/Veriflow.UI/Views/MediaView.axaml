<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Veriflow.UI.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="1520" d:DesignHeight="820"
             x:Class="Veriflow.UI.Views.MediaView"
             x:DataType="vm:MediaViewModel"
             x:CompileBindings="False"
             DragDrop.AllowDrop="True">
    
    <Design.DataContext>
        <vm:MediaViewModel />
    </Design.DataContext>
    
    <!-- Professional Styles (aligned with OFFLOAD) -->
    <UserControl.Styles>
        <Style Selector="Border.MediaCard">
            <Setter Property="Background" Value="{DynamicResource Brush.Background.Secondary}" />
            <Setter Property="BorderBrush" Value="{DynamicResource Brush.Border.Default}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="16" />
        </Style>
        
        <Style Selector="TextBox.PathDisplay">
            <Setter Property="Background" Value="{DynamicResource Brush.Surface.Input}" />
            <Setter Property="BorderBrush" Value="{DynamicResource Brush.Border.Default}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Primary}" />
            <Setter Property="FontSize" Value="{StaticResource FontSize.Small}" />
            <Setter Property="Padding" Value="10,8" />
        </Style>
    </UserControl.Styles>
    
    <Grid RowDefinitions="Auto,*,Auto" Background="{DynamicResource Brush.Background.Primary}">
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="4" Margin="20,20,20,24">
            <TextBlock Text="MEDIA - Library &amp; Metadata" 
                      FontSize="{StaticResource FontSize.H1}"
                      FontWeight="{StaticResource FontWeight.Bold}"
                      Foreground="{DynamicResource Brush.Text.Primary}" />
        </StackPanel>
        
        <!-- Main Content: 3 Columns -->
        <Grid Grid.Row="1" ColumnDefinitions="200,*,320" Margin="20,0,20,20" ColumnSpacing="16">
            
            <!-- Column 0: Files TreeView -->
            <Border Grid.Column="0" Classes="MediaCard">
                <Grid RowDefinitions="Auto,*">
                    <TextBlock Grid.Row="0" 
                              Text="Files"
                              FontSize="{StaticResource FontSize.Small}"
                              FontWeight="{StaticResource FontWeight.SemiBold}"
                              Foreground="{DynamicResource Brush.Text.Primary}"
                              Margin="0,0,0,12" />
                    
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <TextBlock Text="TreeView placeholder"
                                  Foreground="{DynamicResource Brush.Text.Secondary}"
                                  FontSize="{StaticResource FontSize.Small}" />
                        <!-- TreeView will be implemented in next iteration -->
                    </ScrollViewer>
                </Grid>
            </Border>
            
            <!-- Column 1: Media Grid + Path Bar -->
            <Border Grid.Column="1" Classes="MediaCard">
                <Grid RowDefinitions="Auto,*">
                    
                    <!-- Path Bar -->
                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                        <TextBox Grid.Column="0"
                                Text="{Binding CurrentPath}"
                                IsReadOnly="True"
                                Classes="PathDisplay" />
                        <Button Grid.Column="1"
                               Command="{Binding BrowseFolderCommand}"
                               Classes="Secondary"
                               Margin="8,0,0,0"
                               ToolTip.Tip="Browse folder">
                            <PathIcon Data="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"
                                     Width="16" Height="16" />
                        </Button>
                    </Grid>
                    
                    <!-- Media Grid/List/Filmstrip Views -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <Grid>
                            
                            <!-- Grid View -->
                            <ItemsControl ItemsSource="{Binding MediaFiles}"
                                         IsVisible="{Binding ViewMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=0}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="150" Height="180" 
                                               Margin="8"
                                               Background="{DynamicResource Brush.Surface.Card}"
                                               BorderBrush="{DynamicResource Brush.Border.Default}"
                                               BorderThickness="1"
                                               CornerRadius="6"
                                               Padding="8"
                                               Cursor="Hand">
                                            <Grid RowDefinitions="*,Auto">
                                                <!-- Thumbnail Placeholder -->
                                                <Border Grid.Row="0"
                                                       Background="{DynamicResource Brush.Background.Primary}"
                                                       CornerRadius="4"
                                                       Margin="0,0,0,8">
                                                    <TextBlock Text="ðŸ“"
                                                              FontSize="48"
                                                              HorizontalAlignment="Center"
                                                              VerticalAlignment="Center" />
                                                </Border>
                                                
                                                <!-- File Name -->
                                                <TextBlock Grid.Row="1"
                                                          Text="{Binding FileName}"
                                                          FontSize="{StaticResource FontSize.Small}"
                                                          Foreground="{DynamicResource Brush.Text.Primary}"
                                                          TextTrimming="CharacterEllipsis"
                                                          TextAlignment="Center" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <!-- List View (DataGrid) -->
                            <DataGrid ItemsSource="{Binding MediaFiles}"
                                     SelectedItem="{Binding SelectedMedia}"
                                     IsVisible="{Binding ViewMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=1}"
                                     AutoGenerateColumns="False"
                                     CanUserResizeColumns="True"
                                     CanUserSortColumns="True"
                                     GridLinesVisibility="None"
                                     HeadersVisibility="Column"
                                     Background="Transparent"
                                     BorderThickness="0">
                                <DataGrid.Columns>
                                    <!-- Icon Column -->
                                    <DataGridTemplateColumn Header="" Width="40">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <PathIcon Width="16" Height="16"
                                                         Foreground="{DynamicResource Brush.Text.Secondary}">
                                                    <PathIcon.Data>
                                                        <MultiBinding Converter="{StaticResource MediaTypeToIconConverter}">
                                                            <Binding Path="Type"/>
                                                        </MultiBinding>
                                                    </PathIcon.Data>
                                                </PathIcon>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    
                                    <!-- File Name Column -->
                                    <DataGridTextColumn Header="File Name" 
                                                       Binding="{Binding FileName}"
                                                       Width="*"/>
                                    
                                    <!-- Duration Column -->
                                    <DataGridTextColumn Header="Duration" 
                                                       Binding="{Binding Duration, StringFormat='{}{0:hh\\:mm\\:ss\\:ff}'}"
                                                       Width="120"/>
                                    
                                    <!-- Format Column -->
                                    <DataGridTextColumn Header="Format" 
                                                       Binding="{Binding Container}"
                                                       Width="80"/>
                                    
                                    <!-- Size Column -->
                                    <DataGridTemplateColumn Header="Size" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding FileSizeBytes, Converter={StaticResource FileSizeConverter}}"
                                                          HorizontalAlignment="Right"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    
                                    <!-- Date Column -->
                                    <DataGridTextColumn Header="Date" 
                                                       Binding="{Binding CreatedDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                                                       Width="120"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            
                            <!-- Filmstrip View -->
                            <Grid IsVisible="{Binding ViewMode, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=2}"
                                 ColumnDefinitions="250,*">
                                
                                <!-- Compact File List -->
                                <ListBox Grid.Column="0"
                                        ItemsSource="{Binding MediaFiles}"
                                        SelectedItem="{Binding SelectedMedia}"
                                        Background="Transparent"
                                        BorderThickness="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding FileName}"
                                                      FontSize="{StaticResource FontSize.Small}"
                                                      TextTrimming="CharacterEllipsis" />
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                
                                <!-- Player Placeholder -->
                                <Border Grid.Column="1"
                                       Background="{DynamicResource Brush.Background.Primary}"
                                       BorderBrush="{DynamicResource Brush.Border.Default}"
                                       BorderThickness="1"
                                       CornerRadius="6"
                                       Margin="12,0,0,0"
                                       Padding="16">
                                    <TextBlock Text="Player Area"
                                              FontSize="{StaticResource FontSize.H2}"
                                              Foreground="{DynamicResource Brush.Text.Secondary}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                                </Border>
                            </Grid>
                            
                        </Grid>
                    </ScrollViewer>
                    
                    <!-- Drag & Drop Overlay -->
                    <Border Grid.Row="0" Grid.RowSpan="2"
                           Background="{DynamicResource Brush.Background.Secondary}"
                           BorderBrush="{DynamicResource Brush.Accent.Video.Default}"
                           BorderThickness="2"
                           CornerRadius="6"
                           IsVisible="{Binding IsDragging}"
                           Opacity="0.95">
                        <StackPanel HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Spacing="12">
                            <PathIcon Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                                     Width="64" Height="64"
                                     Foreground="{DynamicResource Brush.Accent.Video.Default}" />
                            <TextBlock Text="Drop media folder or file here"
                                      FontSize="{StaticResource FontSize.H2}"
                                      Foreground="{DynamicResource Brush.Text.Primary}"
                                      HorizontalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
            
            <!-- Column 2: Details Panel -->
            <Border Grid.Column="2" Classes="MediaCard">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16" IsVisible="{Binding SelectedMedia, Converter={x:Static ObjectConverters.IsNotNull}}">
                        <TextBlock Text="Details"
                                  FontSize="{StaticResource FontSize.Small}"
                                  FontWeight="{StaticResource FontWeight.SemiBold}"
                                  Foreground="{DynamicResource Brush.Text.Primary}" />
                        
                        <!-- Basic Info -->
                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="6">
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Filename:" Foreground="{DynamicResource Brush.Text.Secondary}" FontSize="{StaticResource FontSize.Small}"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedMedia.FileName}" TextWrapping="Wrap" FontSize="{StaticResource FontSize.Small}"/>
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Size:" Foreground="{DynamicResource Brush.Text.Secondary}" FontSize="{StaticResource FontSize.Small}"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedMedia.FileSizeBytes, Converter={StaticResource FileSizeConverter}}" FontSize="{StaticResource FontSize.Small}"/>
                            
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Duration:" Foreground="{DynamicResource Brush.Text.Secondary}" FontSize="{StaticResource FontSize.Small}"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedMedia.Duration, StringFormat='{}{0:hh\\:mm\\:ss\\:ff}'}" FontSize="{StaticResource FontSize.Small}"/>
                            
                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Date:" Foreground="{DynamicResource Brush.Text.Secondary}" FontSize="{StaticResource FontSize.Small}"/>
                            <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SelectedMedia.CreatedDate, StringFormat='{}{0:yyyy-MM-dd}'}" FontSize="{StaticResource FontSize.Small}"/>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
        </Grid>
        
        <!-- Log Console (Footer) -->
        <Border Grid.Row="2" 
               Classes="MediaCard"
               Margin="20,0,20,20"
               MinHeight="100"
               MaxHeight="150">
            <Grid RowDefinitions="Auto,*">
                <TextBlock Grid.Row="0" 
                          Text="Log Console"
                          FontSize="{StaticResource FontSize.Small}"
                          FontWeight="{StaticResource FontWeight.SemiBold}"
                          Foreground="{DynamicResource Brush.Text.Primary}"
                          Margin="0,0,0,8" />
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <TextBlock Text="Ready"
                              FontFamily="Consolas"
                              FontSize="{StaticResource FontSize.Small}"
                              Foreground="{DynamicResource Brush.Text.Secondary}" />
                </ScrollViewer>
            </Grid>
        </Border>
        
    </Grid>
</UserControl>
